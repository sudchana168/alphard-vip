#!/bin/bash

# ===========================
# CONFIG
# ===========================
REPO_PATH="/var/www/vhosts/easyalphardbkk.com/repo"
WEB_PATH="/var/www/vhosts/easyalphardbkk.com/httpdocs"
BRANCH="main" # à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸›à¹‡à¸™ branch à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£ deploy

# ===========================
# Helper for colored log
# ===========================
green() { echo -e "\033[32m$1\033[0m"; }
yellow() { echo -e "\033[33m$1\033[0m"; }
red() { echo -e "\033[31m$1\033[0m"; }
blue() { echo -e "\033[34m$1\033[0m"; }

# ===========================
# Deployment script
# ===========================
blue "ğŸš€ Starting deployment for easyalphardbkk.com at $(date)"

cd "$REPO_PATH" || { red "âŒ Repo path not found!"; exit 1; }

yellow "ğŸ“¥ Pulling latest changes from $BRANCH..."
git reset --hard
git clean -fd
git pull origin "$BRANCH" || { red "âŒ Git pull failed!"; exit 1; }

yellow "ğŸ“¦ Installing dependencies..."
npm install --force || { red "âŒ npm install failed!"; exit 1; }

yellow "ğŸ›  Building project..."
npm run build || { red "âŒ Build failed!"; exit 1; }

yellow "ğŸ“‚ Deploying to $WEB_PATH..."
rsync -av --delete "$REPO_PATH/build/" "$WEB_PATH/" || { red "âŒ Deploy failed!"; exit 1; }

green "âœ… Deployment finished successfully at $(date)"
